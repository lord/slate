<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Integração web e e-commerce</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["xml","shell"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="xml">XML Comentado</a>
              <a href="#" data-language-name="shell">cURL</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='integrao-web-e-e-commerce'>Integração web e e-commerce</h1>
<p>O processo de compra em uma loja virtual começa sempre com o cliente consumidor escolhendo um ou mais produtos, adicionando-os ao carrinho, fazendo revisão, até chegar ao pagamento por aqueles produtos. O cliente consumidor é sempre o ponto de partida de qualquer integração web com sistemas de pagamento. Independentemente de ser um pagamento com recorrência, compra com um clique, autorização ou, até mesmo, uma captura futura, sempre haverá o participante cliente consumidor tomando a decisão por adquirir um produto ou serviço.</p>

<p>Uma vez tomada a decisão, por parte do cliente consumidor, por efetuar o pagamento através de cartão de crédito, débito, voucher, etc, dois novos participantes iniciam uma comunicação através de trocas de mensagens, para autorizar a transação e fazer sua captura.</p>

<ol>
<li>Adquirente</li>
<li>Banco emissor do cartão</li>
</ol>

<p>Adquirente é a empresa responsável por fazer a comunicação com o banco emissor. Cada banco emissor possui seu próprio fluxo, meio de comunicação, tecnologia de segurança, protocolo, etc. Quando uma loja virtual faz a integração através de um adquirente, está se beneficiando de todo um investimento em tecnologias e segurança, além de um mecanismo único para se comunicar com o banco emissor, independentemente da tecnologia utilizada pelo banco.</p>

<p>Se a loja virtual precisasse aceitar pagamentos através de três bandeiras de cartão de crédito diferentes, três processos de integração diferentes seriam necessários. Como o adquirente já fez esse investimento no processo de integração, o custo de integração través adquirente é muito menor para a loja, do que seria se a integração fosse feita diretamente com as bandeiras.</p>
<h1 id='fluxo-de-comunicao'>Fluxo de comunicação</h1>
<p>Toda a comunicação começa com o cliente consumidor, portador do cartão, optando por fazer o pagamento com um cartão aceito pela loja virtual. A loja virtual, por sua vez, envia uma mensagem para o adquirente, solicitando o processamento do pagamento. Assim como ocorre com pagamentos em maquinetas, o cliente precisará informar seus dados de autenticação e o pagamento poderá ser autorizado ou negado pelo adquirente, seja por informações incorretas, ou algum eventual problema.</p>

<p><img alt="fluxo" src="images/fluxo.png" /></p>
<h1 id='protocolo'>Protocolo</h1>
<p>Durante o fluxo de comunicação, algumas mensagens serão enviadas a partir da loja online, para o Adquirente. Essas mensagens são enviadas no formato XML através do protocolo HTTP, utilizando a arquitetura REST. Essa arquitetura permite que representações da transação possam ser enviadas ou recebidas pela loja online, segundo seu estado atual.</p>

<p>Por exemplo, para criar uma autorização, a loja deverá enviar uma mensagem <a href="#">AcceptorAuthorisationRequest</a> para o adquirente, que irá checar com o banco emissor se o cliente consumidor possui recursos para financiar o pagamento. Nessa mensagem, além dos dados de credenciamento da loja, a loja enviará os dados do dono do cartão e os dados da transação, como valor total, número de parcelas, etc.</p>
<h1 id='mensagens'>Mensagens</h1>
<p>Todas as mensagens serão enviadas através do protocolo HTTP. Todas as mensagens são enviadas utilizando o método <strong>POST</strong> para o seguinte endpoint:</p>

<ul>
<li>Para o ambiente de produção <a href="http://pos.stone.com.br">http://pos.stone.com.br</a>.</li>
<li>Para o ambiente de testes  <a href="http://dev.stone.com.br">http://dev.stone.com.br</a>.</li>
</ul>
<h2 id='mensagens-de-autorizao'>Mensagens de Autorização</h2>
<p>É o processo de troca de mensagens entre o estabelecimento e o adquirente onde é verificado se portador do cartão possui ou não saldo suficiente para a realização de um pagamento. A diferença entre a mensagem de autorização com captura automática e com captura posterior, está no elemento <code class="prettyprint">TxCaptr</code> que deve ser informado <code class="prettyprint">true</code> para Autorização com Captura, ou <code class="prettyprint">false</code> para Autorização com Captura posterior.</p>
<h3 id='requisio-de-autorizao'>Requisição de autorização</h3>
<p>A mensagem de <code class="prettyprint">AcceptorAuthorisationRequest</code> é enviada pelo estabelecimento para o adquirente, para checar junto ao banco que a conta associada ao cartão possui recursos para financiar o pagamento. Este controle inclui a validação dos dados do cartão e todos os dados adicionais previstos.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorAuthorisationRequestV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrAuthstnReq&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da requisição --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>AUTQ<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Dados da requisição de autorização. --&gt;</span>
        <span class="nt">&lt;AuthstnReq&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>
                        <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente.
                             Também conhecido internamente como “SaleAffiliationKey”. --&gt;</span>
                        <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                        <span class="c">&lt;!-- O nome que aparecerá na fatura.
                             - se a transação for mastercard, o limite é 22 caracteres;
                             - se a transação for visa, o limite é 25 caracteres;
                             - se for parcelado, a visa usa os 8 primeiros caracteres do
                               nome do lojista pra passar a informação de parcelamento,
                               sobrando 17 caracteres. --&gt;</span>
                        <span class="nt">&lt;ShortName&gt;</span>Nome da fatura<span class="nt">&lt;/ShortName&gt;</span>
                    <span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
                <span class="c">&lt;!-- Dados do ponto de interação --&gt;</span>
                <span class="nt">&lt;POI&gt;</span>
                    <span class="c">&lt;!-- Identificação do ponto de interação --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>
                        <span class="c">&lt;!-- Código de identificação do ponto de interação
                             atribuído pelo estabelecimento. --&gt;</span>
                        <span class="nt">&lt;Id&gt;</span>2FB4C89A<span class="nt">&lt;/Id&gt;</span>
                    <span class="nt">&lt;/Id&gt;</span>
                    <span class="c">&lt;!-- Capacidades do Ponto de interação. --&gt;</span>
                    <span class="nt">&lt;Cpblties&gt;</span>
                        <span class="c">&lt;!-- Número máximo de colunas de cada linha a ser impressa
                             no cupom. A quantidade mínima de colunas é de 38.
                             Se o POI enviar menos do que 38, o Host Stone não irá
                             retornar os dados do recibo. --&gt;</span>
                        <span class="nt">&lt;PrtLineWidth&gt;</span>50<span class="nt">&lt;/PrtLineWidth&gt;</span>
                    <span class="nt">&lt;/Cpblties&gt;</span>
                <span class="nt">&lt;/POI&gt;</span>
                <span class="c">&lt;!-- Dados do cartão utilizado na transação. --&gt;</span>
                <span class="nt">&lt;Card&gt;</span>
                    <span class="c">&lt;!-- Dados não criptografados do cartão utilizado na transação. --&gt;</span>
                    <span class="nt">&lt;PlainCardData&gt;</span>
                        <span class="c">&lt;!-- Número do cartão. (Primary Account Number) --&gt;</span>
                        <span class="nt">&lt;PAN&gt;</span>4066559930861909<span class="nt">&lt;/PAN&gt;</span>
                        <span class="c">&lt;!-- Data de validade do cartão no formato “yyyy-MM”. --&gt;</span>
                        <span class="nt">&lt;XpryDt&gt;</span>2017-10<span class="nt">&lt;/XpryDt&gt;</span>
                    <span class="nt">&lt;/PlainCardData&gt;</span>
                <span class="nt">&lt;/Card&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Informações da transação a ser realizada. --&gt;</span>
            <span class="nt">&lt;Cntxt&gt;</span>
                <span class="c">&lt;!-- Informações sobre o pagamento. --&gt;</span>
                <span class="nt">&lt;PmtCntxt&gt;</span>
                    <span class="c">&lt;!-- Modo da entrada dos dados do cartão.
                         PHYS = Ecommerce ou Digitada; --&gt;</span>
                    <span class="nt">&lt;CardDataNtryMd&gt;</span>PHYS<span class="nt">&lt;/CardDataNtryMd&gt;</span>
                    <span class="c">&lt;!-- Tipo do canal de comunicação utilizado na transação.
                         ECOM = Ecommerce ou Digitada --&gt;</span>
                    <span class="nt">&lt;TxChanl&gt;</span>ECOM<span class="nt">&lt;/TxChanl&gt;</span>
                <span class="nt">&lt;/PmtCntxt&gt;</span>
            <span class="nt">&lt;/Cntxt&gt;</span>
            <span class="c">&lt;!-- Informações da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Identificação da transação definida pelo sistema que se
                     comunica com o Host Stone. --&gt;</span>
                <span class="nt">&lt;InitrTxId&gt;</span>123123123<span class="nt">&lt;/InitrTxId&gt;</span>
                <span class="c">&lt;!-- Indica se os dados da transação devem ser capturados (true)
                     ou não (false) imediatamente. --&gt;</span>
                <span class="nt">&lt;TxCaptr&gt;</span>false<span class="nt">&lt;/TxCaptr&gt;</span>
                <span class="c">&lt;!-- Dados de identificação da transação atribuída pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data local e hora da transação atribuídas pelo POI. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:11:06<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo ponto de interação (POI,
                         estabelecimento, lojista, etc). O formato é livre contendo no
                         máximo 32 caracteres. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>06064f516a50483da7f189243c95ccca<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação. --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217.--&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total da transação em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                    <span class="c">&lt;!-- Modalidade do cartão utilizado na transação. --&gt;</span>
                    <span class="nt">&lt;AcctTp&gt;</span>CRDT<span class="nt">&lt;/AcctTp&gt;</span>
                    <span class="c">&lt;!-- Os dados relativos à(s) parcela(s) ou a uma transação recorrente. --&gt;</span>
                    <span class="nt">&lt;RcrngTx&gt;</span>
                        <span class="c">&lt;!-- Tipo de parcelamento. --&gt;</span>
                        <span class="nt">&lt;InstlmtTp&gt;</span>NONE<span class="nt">&lt;/InstlmtTp&gt;</span>
                        <span class="c">&lt;!-- Número do total de parcelas. --&gt;</span>
                        <span class="nt">&lt;TtlNbOfPmts&gt;</span>0<span class="nt">&lt;/TtlNbOfPmts&gt;</span>
                    <span class="nt">&lt;/RcrngTx&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/AuthstnReq&gt;</span>
    <span class="nt">&lt;/AccptrAuthstnReq&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem.</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. Valor Fixo: <code class="prettyprint">AUTQ</code> = <code class="prettyprint">AuthorisationRequest</code>.</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>AuthorisationRequest<code class="prettyprint">&lt;AuthstnReq&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da requisição de autorização.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant <code class="prettyprint">&lt;Mrchnt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;ID&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação do estabelecimento comercial.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;ID&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido internamente como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>ShortName</td>
<td>[0..1]</td>
<td>Text</td>
<td>O nome que aparecerá na fatura.  Se a transação for mastercard, o limite é 22 caracteres; Se a transação for visa, o limite é 25 caracteres; Se for parcelado, a visa usa os 8 primeiros caracteres do nome do lojista pra passar a informação de parcelamento, sobrando 17 caracteres.</td>
</tr>
<tr>
<td>Poi<code class="prettyprint">&lt;POI&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do ponto de interação</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;ID&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação do ponto de interação</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;ID&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Código de identificação do ponto de interação atribuído pelo estabelecimento.</td>
</tr>
<tr>
<td>Capabilities<code class="prettyprint">&lt;Cpblties&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Capacidades do Ponto de interação.</td>
</tr>
<tr>
<td>PrintLineWidth<code class="prettyprint">&lt;PrtLineWidth&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Número máximo de colunas de cada linha a ser impressa no cupom. A quantidade mínima de colunas é de 38. Se o POI enviar menos do que 38, o Host Stone não irá retornar os dados do recibo.</td>
</tr>
<tr>
<td>Card<code class="prettyprint">&lt;Card&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do cartão utilizado na transação.</td>
</tr>
<tr>
<td>PlainCardData<code class="prettyprint">&lt;PlainCardData&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados não criptografados do cartão utilizado na transação.</td>
</tr>
<tr>
<td>PAN<code class="prettyprint">&lt;PAN&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Número do cartão. (Primary Account Number)</td>
</tr>
<tr>
<td>ExpiryDate<code class="prettyprint">&lt;XpryDt&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Data de validade do cartão no formato “yyyy-MM”.</td>
</tr>
<tr>
<td>Context<code class="prettyprint">&lt;Cntxt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações da transação a ser realizada.</td>
</tr>
<tr>
<td>PaymentContext<code class="prettyprint">&lt;PmtCntxt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações sobre o pagamento.</td>
</tr>
<tr>
<td>CardDataEntryMode<code class="prettyprint">&lt;CardDataNtryMd&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Modo da entrada dos dados do cartão: <code class="prettyprint">MGST</code> = Tarja magnética; <code class="prettyprint">CICC</code> = ICC (Chip); <code class="prettyprint">PHYS</code> = Ecommerce ou Digitada;</td>
</tr>
<tr>
<td>TransactionChannel<code class="prettyprint">&lt;TxChanl&gt;</code></td>
<td>[0..1]</td>
<td>CodeSet</td>
<td>Tipo do canal de comunicação utilizado na transação. Obs.: Preencher esta tag apenas se <code class="prettyprint">CardDataNtryMd</code> = <code class="prettyprint">PHYS</code> ou <code class="prettyprint">ECOM</code> = <code class="prettyprint">Ecommerce ou Digitada</code></td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações da transação.</td>
</tr>
<tr>
<td>InitiatorTransactionIdentification<code class="prettyprint">&lt;InitrTxId&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo sistema que se comunica com o Host Stone.</td>
</tr>
<tr>
<td>TransactionCapture<code class="prettyprint">&lt;TxCaptr&gt;</code></td>
<td>[1..1]</td>
<td>Boolean</td>
<td>Indica se os dados da transação devem ser capturados - <code class="prettyprint">true</code> - ou não <code class="prettyprint">false</code> - imediatamente.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de identificação da transação atribuída pelo POI (Ponto de interação).</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data local e hora da transação atribuídas pelo POI (ponto de interação).</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo ponto de interação (POI, estabelecimento, lojista, etc). O formato é livre contendo no máximo 32 caracteres.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação.</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a <a href="http://pt.wikipedia.org/wiki/ISO_4217">ISO 4217</a> - <code class="prettyprint">986</code> = Real Brasileiro.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total da transação em centavos.</td>
</tr>
<tr>
<td>AccountType<code class="prettyprint">&lt;AcctTp&gt;</code></td>
<td>[0..1]</td>
<td>CodeSet</td>
<td>Modalidade do cartão utilizado na transação. <code class="prettyprint">CHCK</code> = Débito e <code class="prettyprint">CRDT</code> = Crédito.</td>
</tr>
<tr>
<td>RecurringTransaction<code class="prettyprint">&lt;RcrngTx&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Os dados relativos à(s) parcela(s) ou a uma transação recorrente.</td>
</tr>
<tr>
<td>InstalmentType<code class="prettyprint">&lt;InstlmtTp&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Tipo de parcelamento. <code class="prettyprint">NONE</code> = Nenhum e <code class="prettyprint">MCHT</code> = Lojista</td>
</tr>
<tr>
<td>TotalNumberOfPayments<code class="prettyprint">&lt;TtlNbOfPmts&gt;</code></td>
<td>[1..1]</td>
<td>Quantity</td>
<td>Número do total de parcelas.</td>
</tr>
</tbody></table>
<h3 id='resposta-de-autorizao'>Resposta de autorização</h3>
<p>A mensagem <code class="prettyprint">AcceptorAuthorisationResponse</code> é enviada pelo adquirente, para retornar o resultado da validação realizada pelo emissor sobre a operação de pagamento.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorAuthorisationResponseV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrAuthstnRspn&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe.
                 AUTP = AuthorisationResponse. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>AUTP<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
            <span class="c">&lt;!-- Dados para rastreamento da mensagem. --&gt;</span>
            <span class="nt">&lt;Tracblt&gt;</span>
                <span class="c">&lt;!-- Data e hora da saída da mensagem no Host Stone. --&gt;</span>
                <span class="nt">&lt;TracDtTmOut&gt;</span>2014-03-12T18:10:58<span class="nt">&lt;/TracDtTmOut&gt;</span>
            <span class="nt">&lt;/Tracblt&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações relacionadas à resposta da autorização. --&gt;</span>
        <span class="nt">&lt;AuthstnRspn&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;MrchntId&gt;</span>
                    <span class="c">&lt;!-- dentificação do estabelecimento comercial no adquirente. Também
                         conhecido internamente como “SaleAffiliationKey”. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/MrchntId&gt;</span>
                <span class="c">&lt;!-- Dados do ponto de interação. --&gt;</span>
                <span class="nt">&lt;PoiId&gt;</span>
                    <span class="c">&lt;!-- Identificador do ponto de interação --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>2FB4C89A<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/PoiId&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Informações da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!--- Dados de identificação da transação atribuída pelo POI --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data local e hora da transação atribuído pelo POI.
                         Este campo será ecoado pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:11:06<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação atribuída pelo POI.
                         Este campo será ecoado pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>06064f516a50483da7f189243c95ccca<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Identificação da transação definida pela Stone. --&gt;</span>
                <span class="nt">&lt;RcptTxId&gt;</span>00000034071000000215353<span class="nt">&lt;/RcptTxId&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação. --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217.
                         986 = BRL = Real Brasileiro
                         http://pt.wikipedia.org/wiki/ISO_4217 --&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total autorizado em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                    <span class="c">&lt;!-- Modalidade do cartão utilizado na transação.
                         CHCK = Débito;
                         CRDT = Crédito. --&gt;</span>
                    <span class="nt">&lt;AcctTp&gt;</span>CHCK<span class="nt">&lt;/AcctTp&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
            <span class="c">&lt;!-- Dados de resposta da transação. --&gt;</span>
            <span class="nt">&lt;TxRspn&gt;</span>
                <span class="c">&lt;!-- Resultado da autorização. --&gt;</span>
                <span class="nt">&lt;AuthstnRslt&gt;</span>
                    <span class="c">&lt;!-- Dados da resposta da autorização. --&gt;</span>
                    <span class="nt">&lt;RspnToAuthstn&gt;</span>
                        <span class="c">&lt;!-- Resposta da transação. --&gt;</span>
                        <span class="nt">&lt;Rspn&gt;</span>APPR<span class="nt">&lt;/Rspn&gt;</span>
                        <span class="c">&lt;!-- Código de resposta da autorização
                             (equivalente ao campo 39 da ISO 8583 de 2003). --&gt;</span>
                        <span class="nt">&lt;RspnRsn&gt;</span>0000<span class="nt">&lt;/RspnRsn&gt;</span>
                    <span class="nt">&lt;/RspnToAuthstn&gt;</span>
                    <span class="c">&lt;!-- Código de autorização retornado pelo emissor. --&gt;</span>
                    <span class="nt">&lt;AuthstnCd&gt;</span>007091<span class="nt">&lt;/AuthstnCd&gt;</span>
                    <span class="c">&lt;!-- Indica se a mensagem precisa ser capturada posteriormente. --&gt;</span>
                    <span class="nt">&lt;CmpltnReqrd&gt;</span>false<span class="nt">&lt;/CmpltnReqrd&gt;</span>
                <span class="nt">&lt;/AuthstnRslt&gt;</span>
                <span class="c">&lt;!-- Informações sobre as ações a serem realizadas pelo POI.
                     Neste caso, as informações a serem impressas no comprovante. --&gt;</span>
                <span class="nt">&lt;Actn&gt;</span>
                    <span class="c">&lt;!-- Tipo da ação a ser realizada pelo POI.--&gt;</span>
                    <span class="nt">&lt;ActnTp&gt;</span>PRNT<span class="nt">&lt;/ActnTp&gt;</span>
                    <span class="c">&lt;!-- Mensagem a ser impressa no terminal. --&gt;</span>
                    <span class="nt">&lt;MsgToPres&gt;</span>
                        <span class="c">&lt;!-- A quem se destina a mensagem no contexto.
                             CRCP = CardholderReceipt;
                             MRCP = MerchantReceipt. --&gt;</span>
                        <span class="nt">&lt;MsgDstn&gt;</span>CRCP<span class="nt">&lt;/MsgDstn&gt;</span>
                        <span class="c">&lt;!-- Texto ou dados gráficos a serem impressos na tela ou em papel
                        no terminal. A mensagem será formatada conforme o campo PrintLineWidth
                        da requisição. --&gt;</span>
                        <span class="nt">&lt;MsgCntt&gt;</span>Informacoes formatadas do recibo aqui<span class="nt">&lt;/MsgCntt&gt;</span>
                    <span class="nt">&lt;/MsgToPres&gt;</span>
                <span class="nt">&lt;/Actn&gt;</span>
            <span class="nt">&lt;/TxRspn&gt;</span>
        <span class="nt">&lt;/AuthstnRspn&gt;</span>
    <span class="nt">&lt;/AccptrAuthstnRspn&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. Fixo: <code class="prettyprint">AUTP</code> = AuthorisationResponse.</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>CreationDateTime<code class="prettyprint">&lt;CreDtTm&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Data de criação da mensagem</td>
</tr>
<tr>
<td>TraceDateTimeOut<code class="prettyprint">&lt;TracDtTmOut&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data e hora da saída da mensagem no Host Stone.</td>
</tr>
<tr>
<td>AuthorisationResponse<code class="prettyprint">&lt;AuthstnRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações relacionadas à resposta da autorização.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant Identification<code class="prettyprint">&lt;MrchntId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido internamente como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>POIId<code class="prettyprint">&lt;POIId&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados do ponto de interação.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do POI.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações da transação.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de identificação da transação atribuída pelo POI (Ponto de interação).</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data local e hora da transação atribuído pelo POI (ponto de interação). Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação atribuída pelo POI (Ponto de interação). Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>RecipientTransactionIdentification<code class="prettyprint">&lt;RcptTxId&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pela Stone.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação.</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a <a href="http://pt.wikipedia.org/wiki/ISO_4217">ISO 4217</a> - <code class="prettyprint">986</code> = Real Brasileiro.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total autorizado em centavos.</td>
</tr>
<tr>
<td>AccountType<code class="prettyprint">&lt;AcctTp&gt;</code></td>
<td>[0..1]</td>
<td>CodeSet</td>
<td>Modalidade do cartão utilizado na transação. <code class="prettyprint">CHCK</code> = Débito e <code class="prettyprint">CRDT</code> = Crédito.</td>
</tr>
<tr>
<td>TransactionResponse<code class="prettyprint">&lt;TxRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de resposta da transação.</td>
</tr>
<tr>
<td>AuthorisationResult<code class="prettyprint">&lt;AuthstnRslt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Resultado da autorização.</td>
</tr>
<tr>
<td>ResponseToAuthorisation<code class="prettyprint">&lt;RspnToAuthstn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da resposta da autorização.</td>
</tr>
<tr>
<td>Response<code class="prettyprint">&lt;Rspn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Resposta da transação: <code class="prettyprint">DECL: Declined</code>, <code class="prettyprint">APPR: Aproved</code>, <code class="prettyprint">PART: PartialApproved</code> e <code class="prettyprint">TECH: TechinicalError</code>.</td>
</tr>
<tr>
<td>ResponseReason<code class="prettyprint">&lt;RspnRsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Código de resposta da autorização (equivalente ao campo 39 da ISO 8583 de 2003).</td>
</tr>
<tr>
<td>AuthorisationCode<code class="prettyprint">&lt;AuthstnCd&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Código de autorização retornado pelo emissor.</td>
</tr>
<tr>
<td>CompletionRequired<code class="prettyprint">&lt;CmpltnReqrd&gt;</code></td>
<td>[0..1]</td>
<td>Boolean</td>
<td>Indica se a mensagem precisa ser capturada posteriormente.</td>
</tr>
<tr>
<td>Action<code class="prettyprint">&lt;Actn&gt;</code></td>
<td>[0..*]</td>
<td>Container</td>
<td>Informações sobre as ações a serem realizadas pelo POI. Neste caso, as informações a serem impressas no comprovante.</td>
</tr>
<tr>
<td>ActionType<code class="prettyprint">&lt;ActnTp&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Tipo da ação a ser realizada pelo POI. <code class="prettyprint">PRNT = Imprimir mensagem;</code> e <code class="prettyprint">DISP = Exibir mensagem.</code></td>
</tr>
<tr>
<td>MessageToPresent<code class="prettyprint">&lt;MsgToPres&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Mensagem a ser impressa no terminal.</td>
</tr>
<tr>
<td>MessageDestination<code class="prettyprint">&lt;MsgDstn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>A quem se destina amensagem no contexto: <code class="prettyprint">CRCP = CardholderReceipt;</code> e <code class="prettyprint">MRCP = MerchantReceipt.</code></td>
</tr>
<tr>
<td>MessageContent<code class="prettyprint">&lt;MsgCntt&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Texto ou dados gráficos a serem impressos na tela ou em papel no terminal. A mensagem será formatada conforme o campo <code class="prettyprint">PrintLineWidth</code> da requisição.</td>
</tr>
</tbody></table>
<h2 id='autorizao-com-captura'>Autorização com Captura</h2>
<p>É o processo de autorização de uma transação onde a captura financeira é realizada no momento do pedido de autorização.</p>

<p><img alt="autorização com captura" src="images/autorizacao-e-captura.png" /></p>

<ol>
<li>O estabelecimento envia uma mensagem <code class="prettyprint">AcceptorAuthorisationRequest</code> para o adquirente solicitando autorização, informando que deseja realizar a captura financeira atribuindo o valor da tag <code class="prettyprint">&lt;TxCaptr&gt;</code> como <code class="prettyprint">true</code></li>
<li><code class="prettyprint">AcceptorAuthorisationResponse</code> é devolvido pelo adquirente, informando ao estabelecimento sobre o êxito do pedido, uma vez que o adquirente tenha autorizado a transação sem a necessidade de envio de captura.</li>
</ol>
<h2 id='autorizao-com-captura-posterior'>Autorização com Captura posterior</h2>
<p>O estabelecimento pode escolher enviar ou não a mensagem de captura para uma transação de crédito. Para as transações de débito, a transação de autorização já é realizada sem a necessidade da mensagem de captura, mesmo que a tag <code class="prettyprint">&lt;TxCaptr&gt;</code> esteja preenchida como <code class="prettyprint">false</code>.</p>

<p><img alt="autorização com captura posterior" src="images/autorizacao-com-captura-posterior.png" /></p>

<ol>
<li>O estabelecimento envia uma <code class="prettyprint">AcceptorAuthorisationRequest</code> ao adquirente solicitando a autorização da transação.</li>
<li>Uma <code class="prettyprint">AcceptorAuthorisationResponse</code> é devolvida pelo adquirente, informando ao estabelecimento sobre o êxito da autorização.</li>
<li>Se a transação tiver sido concluída com êxito no lado do estabelecimento, o estabelecimento envia uma <code class="prettyprint">AcceptorCompletionAdvice</code> para capturar a transação.</li>
<li>O adquirente retorna uma <code class="prettyprint">AcceptorCompletionAdviceResponse</code>, reconhecendo o resultado e captura financeira da transação.</li>
</ol>
<h3 id='xml-de-requisio-de-captura-comentado'>XML de requisição de Captura comentado</h3>
<p>A mensagem <code class="prettyprint">AcceptorCompletionAdvice</code> é enviada pelo estabelecimento para confirmar uma transação previamente autorizada. Esta mensagem também é utilizada como um pedido de desfazimento de transações.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCompletionAdviceV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCmpltnAdvc&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem. --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>CMPV<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações relacionadas ao processo de captura ou desfazimento de uma autorização. --&gt;</span>
        <span class="nt">&lt;CmpltnAdvc&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>00000000000000000000000000000321<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Identificação da transação definida pelo sistema que se comunica com
                     o Host Stone. --&gt;</span>
                <span class="nt">&lt;InitrTxId&gt;</span>123123123<span class="nt">&lt;/InitrTxId&gt;</span>
                <span class="c">&lt;!-- Dados de identificação da transação atribuída pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data local e hora da transação atribuído pelo POI. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-06-11T17:15:44<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação atribuída pelo POI. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>1111<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Identificação da transação original --&gt;</span>
                <span class="nt">&lt;OrgnlTx&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;RcptTxId&gt;</span>9CDF257AQKR<span class="nt">&lt;/RcptTxId&gt;</span>
                <span class="nt">&lt;/OrgnlTx&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação. --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217. --&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total da transação em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/CmpltnAdvc&gt;</span>
    <span class="nt">&lt;/AccptrCmpltnAdvc&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<Hdr></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem.</td>
</tr>
<tr>
<td>MessageFunction<MsgFctn></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. <code class="prettyprint">CMPV = Completion Advice</code> ou <code class="prettyprint">RVRA = ReversalAdvice</code>.</td>
</tr>
<tr>
<td>ProtocolVersion <PrtcolVrsn></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão atual: “2.0”.</td>
</tr>
<tr>
<td>CompletionAdvice <CmpltnAdvc></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações relacionadas ao processo de captura ou desfazimento de uma autorização.</td>
</tr>
<tr>
<td>Environment<Envt></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant <Mrchnt></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<Id></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido internamente como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>InitiatorTransactionIdentification<code class="prettyprint">&lt;InitrTxId&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo sistema que se comunica com o Host Stone.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de identificação da transação atribuída pelo POI.</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data local e hora da transação atribuído pelo POI. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação atribuída pelo POI. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>OriginalTransaction<code class="prettyprint">&lt;OrgnlTx&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Identificação da transação original</td>
</tr>
<tr>
<td>RecipientTransactionIdentification<code class="prettyprint">&lt;RcptTxId&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo adquirente.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação.</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a ISO 4217.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total da transação em centavos.</td>
</tr>
</tbody></table>
<h3 id='xml-de-resposta-de-captura-comentado'>XML de resposta de Captura comentado</h3>
<p>A mensagem <code class="prettyprint">AcceptorCompletionAdviceResponse</code> é enviada pelo adquirente para avisar o estabelecimento sobre o reconhecimento do resultado da operação de pagamento, bem como a transferência dos dados financeiros da transação contidas no <code class="prettyprint">AcceptorCompletionAdvice</code>. Esta mensagem também é utilizada como resposta para o processo de “desfazimento de transações”.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCompletionAdviceResponseV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCmpltnAdvcRspn&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem. --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe.
                 CMPK = CompletionAdviceResponse ou
                 RVRR = ReversalAdviceResponse. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>CMPK<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações sobre a resposta da captura ou desfazimento de uma autorização. --&gt;</span>
        <span class="nt">&lt;CmpltnAdvcRspn&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente.
                         Também conhecido internamente como “SaleAffiliationKey”. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Dados da identificação da transação definida pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data e hora da transação --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:17:59<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo ponto de interação (POI,
                         estabelecimento, lojista, etc). Este campo será ecoado pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>7ca686eb242b4c0482c58961f5d3aac7<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Resultado da transação.
                     DECL = Declined,
                     APPR = Approved,
                     PART = Partial Approved,
                     TECH = Technical Error. --&gt;</span>
                <span class="nt">&lt;Rspn&gt;</span>APPR<span class="nt">&lt;/Rspn&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/CmpltnAdvcRspn&gt;</span>
    <span class="nt">&lt;/AccptrCmpltnAdvcRspn&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem.</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. “CMPK” = CompletionAdviceResponse ou “RVRR” = ReversalAdviceResponse.</td>
</tr>
<tr>
<td>CreationDateTime<code class="prettyprint">&lt;CreDtTm&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Data de criação da mensagem</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>CompletionAdviceResponse<code class="prettyprint">&lt;CmpltnAdvcRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações sobre a resposta da captura ou desfazimento de uma autorização.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant Identification<code class="prettyprint">&lt;MrchntId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>POIId<code class="prettyprint">&lt;POIId&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados do ponto de interação.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da identificação da transação definida pelo POI.</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data e hora da transação</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo ponto de interação. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>Response<code class="prettyprint">&lt;Rspn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Resultado da transação. DECL = Declined, APPR = Approved, PART = Partial Approved, TECH = Technical Error.</td>
</tr>
</tbody></table>
<h2 id='reverso'>Reversão</h2>
<p>A reversão ou desfazimento de uma transação é realizado quando há alguma falha na transação. O prazo para a realização do desfazimento é de 5 dias e o tempo máximo de espera para de uma reposta <code class="prettyprint">AcceptorCompletionAdvice</code> é de 50 segundos.</p>

<p><img alt="reversão" src="images/reversao.png" /></p>

<ol>
<li>Uma <code class="prettyprint">AcceptorAuthorisationRequest</code> é enviada pelo estabelecimento para o adquirente solicitando autorização.</li>
<li>Uma <code class="prettyprint">AcceptorAuthorisationResponse</code> é devolvida pelo adquirente informando ao estabelecimento sobre o êxito do pedido, uma vez que o adquirente tenha autorizado a transação.</li>
<li>No caso de falha no estabelecimento, uma <code class="prettyprint">AcceptorCompletionAdvice</code> é então enviada para o adquirente para desfazer a transação.</li>
<li>O adquirente envia de volta uma <code class="prettyprint">AcceptorCompletionAdviceResponse</code> reconhecendo o desfazimento.</li>
</ol>
<h3 id='xml-de-requisio-de-desfazimento-comentado'>XML de requisição de Desfazimento comentado</h3><pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCompletionAdviceV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCmpltnAdvc&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem. --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>RVRA<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações relacionadas ao processo de captura ou desfazimento de uma autorização. --&gt;</span>
        <span class="nt">&lt;CmpltnAdvc&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Container contendo o identificador do lojista. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>
                        <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente. --&gt;</span>
                        <span class="nt">&lt;Id&gt;</span>00000000000000000000000000000321<span class="nt">&lt;/Id&gt;</span>
                    <span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Dados de identificação da transação atribuída pelo POI --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data local e hora da transação atribuído pelo POI. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-06-11T17:15:44<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação atribuída pelo POI. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>1111<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Identificação da transação original --&gt;</span>
                <span class="nt">&lt;OrgnlTx&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;RcptTxId&gt;</span>9CDF257AQKR<span class="nt">&lt;/RcptTxId&gt;</span>
                <span class="nt">&lt;/OrgnlTx&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação. --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217. --&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total da transação em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/CmpltnAdvc&gt;</span>
    <span class="nt">&lt;/AccptrCmpltnAdvc&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<Hdr></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem.</td>
</tr>
<tr>
<td>MessageFunction<MsgFctn></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. <code class="prettyprint">CMPV = Completion Advice</code> ou <code class="prettyprint">RVRA = ReversalAdvice</code>.</td>
</tr>
<tr>
<td>CreationDateTime <CreDtTm></td>
<td>[0..1]</td>
<td>DateTime</td>
<td>Data e hora de onde o arquivo ou mensagem foram criados.</td>
</tr>
<tr>
<td>ProtocolVersion <PrtcolVrsn></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão atual: “2.0”.</td>
</tr>
<tr>
<td>CompletionAdvice <CmpltnAdvc></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações relacionadas ao processo de captura ou desfazimento de uma autorização.</td>
</tr>
<tr>
<td>Environment<Envt></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant <Mrchnt></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<Id></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido internamente como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de identificação da transação atribuída pelo POI.</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data local e hora da transação atribuído pelo POI. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação atribuída pelo POI. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>OriginalTransaction<code class="prettyprint">&lt;OrgnlTx&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Identificação da transação original</td>
</tr>
<tr>
<td>RecipientTransactionIdentification<code class="prettyprint">&lt;RcptTxId&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo adquirente.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação.</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a ISO 4217.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total da transação em centavos.</td>
</tr>
</tbody></table>
<h3 id='xml-de-resposta-de-desfazimento-comentado'>XML de resposta de Desfazimento comentado</h3>
<p>A mensagem <code class="prettyprint">AcceptorCompletionAdviceResponse</code> é enviada pelo adquirente para avisar o estabelecimento sobre o reconhecimento do resultado da operação de pagamento, bem como a transferência dos dados financeiros da transação contidas no AcceptorCompletionAdvice. Esta mensagem também é utilizada como resposta para o processo de “desfazimento de transações”.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCompletionAdviceResponseV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCmpltnAdvcRspn&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem. --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- dentifica o tipo de processo em que a mensagem se propõe.
            CMPK = CompletionAdviceResponse ou
            RVRR = ReversalAdviceResponse. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>RVRR<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações sobre a resposta da captura ou desfazimento de uma autorização. --&gt;</span>
        <span class="nt">&lt;CmpltnAdvcRspn&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente.
                         Também conhecido internamente como “SaleAffiliationKey”. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Dados da identificação da transação definida pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data e hora da transação --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:17:59<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo ponto de interação.
                         Este campo será ecoado pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>7ca686eb242b4c0482c58961f5d3aac7<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Resultado da transação.
                     DECL = Declined,
                     APPR = Approved,
                     PART = Partial Approved,
                     TECH = Technical Error. --&gt;</span>
                <span class="nt">&lt;Rspn&gt;</span>APPR<span class="nt">&lt;/Rspn&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/CmpltnAdvcRspn&gt;</span>
    <span class="nt">&lt;/AccptrCmpltnAdvcRspn&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem.</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. “CMPK” = CompletionAdviceResponse ou “RVRR” = ReversalAdviceResponse.</td>
</tr>
<tr>
<td>CreationDateTime<code class="prettyprint">&lt;CreDtTm&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Data de criação da mensagem</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>CompletionAdviceResponse<code class="prettyprint">&lt;CmpltnAdvcRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações sobre a resposta da captura ou desfazimento de uma autorização.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant Identification<code class="prettyprint">&lt;MrchntId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>POIId<code class="prettyprint">&lt;POIId&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados do ponto de interação.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da identificação da transação definida pelo POI.</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data e hora da transação</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo ponto de interação. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>Response<code class="prettyprint">&lt;Rspn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Resultado da transação. DECL = Declined, APPR = Approved, PART = Partial Approved, TECH = Technical Error.</td>
</tr>
</tbody></table>
<h2 id='cancelamento'>Cancelamento</h2>
<p>O cancelamento é o serviço que permite que um estabelecimento cancele uma transação concluída com êxito. É por vezes chamado de “desfazimento manual”. O prazo para é 180 dias para o cancelamento.</p>

<p><img alt="cancelamento" src="images/cancelamento-com-captura.png" /></p>

<ol>
<li>O estabelecimento envia uma <code class="prettyprint">AcceptorAuthorisationRequest</code> para o adquirente para realizar um pedido de autorização</li>
<li>Uma <code class="prettyprint">AcceptorAuthorisationResponse</code> é enviada pelo adquirente confirmando e aprovando o pedido de autorização</li>
<li>Uma <code class="prettyprint">AcceptorCompletionAdvice</code> é utilizada para informar ao adquirente sobre a captura da transação</li>
<li>O adquirente envia uma <code class="prettyprint">AcceptorCompletionAdviceResponse</code> reconhecendo o pedido de cancelamento por parte do estabelecimento;</li>
</ol>

<p>Nesta transação o estabelecimento não necessita de nenhum pedido de cancelamento prévio pois supomos que ele já possui as informações de que o cancelamento pode realmente ser realizado.</p>

<ol>
<li>Por sua vez, o estabelecimento envia uma <code class="prettyprint">AcceptorCancellationAdvice</code> para informar ao adquirente que a transação autorizada previamente deve ser cancelada</li>
<li>O adquirente envia uma <code class="prettyprint">AcceptorCancellationAdviceResponse</code> reconhecendo o cancelamento, e realiza os ajustes necessários.</li>
</ol>
<h3 id='xml-de-requisio-de-cancelamento-comentado'>XML de requisição de Cancelamento comentado</h3>
<p>A mensagem <code class="prettyprint">AcceptorCancellationRequest</code> é utilizada para realizar um pedido de cancelamento de uma transação autorizada. Se faz necessária uma mensagem de <code class="prettyprint">AcceptorCancellationAdvice</code> para que o cancelamento seja confirmado caso o valor da tag <code class="prettyprint">TransactionCapture&lt;TxCaptr&gt;</code> seja <code class="prettyprint">false</code> .</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCancellationRequestV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCxlReq&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>CCAQ<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações relacionadas à requisição de cancelamento. --&gt;</span>
        <span class="nt">&lt;CxlReq&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;Mrchnt&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento comercial. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>
                        <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente. --&gt;</span>
                        <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                    <span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/Mrchnt&gt;</span>
                <span class="c">&lt;!-- Dados do Ponto de Interação. --&gt;</span>
                <span class="nt">&lt;POI&gt;</span>
                    <span class="c">&lt;!-- Identificação do ponto de interação --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>
                        <span class="c">&lt;!-- Código de identificação do POI atribuído pelo estabelecimento. --&gt;</span>
                        <span class="nt">&lt;Id&gt;</span>2FB4C89A<span class="nt">&lt;/Id&gt;</span>
                    <span class="nt">&lt;/Id&gt;</span>
                    <span class="c">&lt;!-- Capacidades do Ponto de interação. --&gt;</span>
                    <span class="nt">&lt;Cpblties&gt;</span>
                        <span class="c">&lt;!-- Número máximo de colunas de cada linha a ser impressa no cupom.
                             A quantidade mínima de colunas é de 38. --&gt;</span>
                        <span class="nt">&lt;PrtLineWidth&gt;</span>50<span class="nt">&lt;/PrtLineWidth&gt;</span>
                    <span class="nt">&lt;/Cpblties&gt;</span>
                <span class="nt">&lt;/POI&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Indica se os dados da transação devem ser capturados `true` ou não
                     `false` imediatamente. --&gt;</span>
                <span class="nt">&lt;TxCaptr&gt;</span>true<span class="nt">&lt;/TxCaptr&gt;</span>
                <span class="c">&lt;!-- Identificação da transação atribuída pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data e hora local da transação definidas pelo ponto de interação. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:09:00<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo ponto de interação.
                         O formato é livre contendo no máximo 32 caracteres. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>12345ABC<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217.--&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total da transação em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
                <span class="c">&lt;!-- Dados da transação original --&gt;</span>
                <span class="nt">&lt;OrgnlTx&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo sistema que se comunica
                         com o Host Stone. --&gt;</span>
                    <span class="nt">&lt;InitrTxId&gt;</span>123123123<span class="nt">&lt;/InitrTxId&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;RcptTxId&gt;</span>00000034071000000215346<span class="nt">&lt;/RcptTxId&gt;</span>
                <span class="nt">&lt;/OrgnlTx&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
        <span class="nt">&lt;/CxlReq&gt;</span>
    <span class="nt">&lt;/AccptrCxlReq&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. Fixo: “CCAQ” = Cancellation Request.</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>CancellationRequest<code class="prettyprint">&lt;CxlReq&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações relacionadas à requisição de cancelamento.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant<code class="prettyprint">&lt;Mrchnt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação do estabelecimento comercial.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>Poi<code class="prettyprint">&lt;POI&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados do Ponto de Interação.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação do ponto de interação</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Código de identificação do ponto de interação atribuído pelo estabelecimento.</td>
</tr>
<tr>
<td>Capabilities</td>
<td>[0..1]</td>
<td>Container</td>
<td>Capacidades do Ponto de interação.</td>
</tr>
<tr>
<td>PrintLineWidth<code class="prettyprint">&lt;PrtLineWidth&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Número máximo de colunas de cada linha a ser impressa no cupom. A quantidade mínima de colunas é de 38. Se o POI enviar menos do que 38, o Host Stone não irá retornar os dados do recibo.</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>TransactionCapture<code class="prettyprint">&lt;TxCaptr&gt;</code></td>
<td>[1..1]</td>
<td>Bool</td>
<td>Indica se os dados da transação devem ser capturados <code class="prettyprint">true</code> ou não <code class="prettyprint">false</code> imediatamente.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação da transação atribuída pelo POI (Ponto de interação).</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data e hora local da transação definidas pelo ponto de interação.</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo ponto de interação. O formato é livre contendo no máximo 32 caracteres.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a ISO 4217.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total da transação em centavos</td>
</tr>
<tr>
<td>OriginalTransaction<code class="prettyprint">&lt;OrgnlTx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação original</td>
</tr>
<tr>
<td>InitiatorTransactionIdentification<code class="prettyprint">&lt;InitrTxId&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo sistema que se comunica com o Host Stone.</td>
</tr>
<tr>
<td>RecipientTransactionIdentification<code class="prettyprint">&lt;RcptTxId&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo adquirente.</td>
</tr>
</tbody></table>
<h3 id='xml-de-resposta-de-cancelamento-comentado'>XML de resposta de Cancelamento comentado</h3>
<p>A mensagem AcceptorCancellationResponse é respondida pelo adquirente com as informações sobre a requisição de cancelamento <code class="prettyprint">AcceptorCancellationRequest</code>. Importante informar que os dados do recibo de cancelamento são enviados somente nesta mensagem.</p>
<pre class="highlight xml"><span class="nt">&lt;Document</span> <span class="na">xmlns=</span><span class="s">"urn:AcceptorCancellationResponseV02.1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AccptrCxlRspn&gt;</span>
        <span class="c">&lt;!-- Cabeçalho da mensagem --&gt;</span>
        <span class="nt">&lt;Hdr&gt;</span>
            <span class="c">&lt;!-- Identifica o tipo de processo em que a mensagem se propõe.
                 CCAP = Cancellation Response. --&gt;</span>
            <span class="nt">&lt;MsgFctn&gt;</span>CCAP<span class="nt">&lt;/MsgFctn&gt;</span>
            <span class="c">&lt;!-- Versão do protocolo utilizado na mensagem. --&gt;</span>
            <span class="nt">&lt;PrtcolVrsn&gt;</span>2.0<span class="nt">&lt;/PrtcolVrsn&gt;</span>
        <span class="nt">&lt;/Hdr&gt;</span>
        <span class="c">&lt;!-- Informações relacionadas à resposta de cancelamento. --&gt;</span>
        <span class="nt">&lt;CxlRspn&gt;</span>
            <span class="c">&lt;!-- Ambiente da transação. --&gt;</span>
            <span class="nt">&lt;Envt&gt;</span>
                <span class="c">&lt;!-- Dados do estabelecimento. --&gt;</span>
                <span class="nt">&lt;MrchntId&gt;</span>
                    <span class="c">&lt;!-- Identificação do estabelecimento comercial no adquirente.
                         Também conhecido internamente como “SaleAffiliationKey”. --&gt;</span>
                    <span class="nt">&lt;Id&gt;</span>BFDB58AB9A8A48828C2647E18B7F1114<span class="nt">&lt;/Id&gt;</span>
                <span class="nt">&lt;/MrchntId&gt;</span>
            <span class="nt">&lt;/Envt&gt;</span>
            <span class="c">&lt;!-- Dados da transação. --&gt;</span>
            <span class="nt">&lt;Tx&gt;</span>
                <span class="c">&lt;!-- Indica se os dados da transação devem ser capturados `true`
                     ou não `false` imediatamente. --&gt;</span>
                <span class="nt">&lt;TxCaptr&gt;</span>true<span class="nt">&lt;/TxCaptr&gt;</span>
                <span class="c">&lt;!-- Identificação da transação atribuída pelo POI. --&gt;</span>
                <span class="nt">&lt;TxId&gt;</span>
                    <span class="c">&lt;!-- Data e hora local da transação definidas pelo ponto de interação. --&gt;</span>
                    <span class="nt">&lt;TxDtTm&gt;</span>2014-03-12T15:09:00<span class="nt">&lt;/TxDtTm&gt;</span>
                    <span class="c">&lt;!-- Identificação da transação definida pelo ponto de interação.
                         Este campo será ecoado pelo adquirente. --&gt;</span>
                    <span class="nt">&lt;TxRef&gt;</span>123456798<span class="nt">&lt;/TxRef&gt;</span>
                <span class="nt">&lt;/TxId&gt;</span>
                <span class="c">&lt;!-- Detalhes da transação --&gt;</span>
                <span class="nt">&lt;TxDtls&gt;</span>
                    <span class="c">&lt;!-- Moeda utilizada na transação em conformidade com a ISO 4217. --&gt;</span>
                    <span class="nt">&lt;Ccy&gt;</span>986<span class="nt">&lt;/Ccy&gt;</span>
                    <span class="c">&lt;!-- Valor total da transação em centavos. --&gt;</span>
                    <span class="nt">&lt;TtlAmt&gt;</span>100<span class="nt">&lt;/TtlAmt&gt;</span>
                <span class="nt">&lt;/TxDtls&gt;</span>
            <span class="nt">&lt;/Tx&gt;</span>
            <span class="c">&lt;!-- Dados de resposta da transação. --&gt;</span>
            <span class="nt">&lt;TxRspn&gt;</span>
                <span class="c">&lt;!-- Informações sobre o resultado da autorização a ser cancelada. --&gt;</span>
                <span class="nt">&lt;AuthstnRslt&gt;</span>
                    <span class="c">&lt;!-- Dados de resposta da autorização a ser cancelada. --&gt;</span>
                    <span class="nt">&lt;RspnToAuthstn&gt;</span>
                        <span class="c">&lt;!-- Resposta da transação.
                             DECL: Declined
                             APPR: Aproved
                             PART: PartialApproved
                             TECH: TechinicalError --&gt;</span>
                        <span class="nt">&lt;Rspn&gt;</span>APPR<span class="nt">&lt;/Rspn&gt;</span>
                        <span class="c">&lt;!-- Código de resposta da autorização
                             equivalente ao campo 39 da ISO 8583 de 2003. --&gt;</span>
                        <span class="nt">&lt;RspnRsn&gt;</span>0000<span class="nt">&lt;/RspnRsn&gt;</span>
                    <span class="nt">&lt;/RspnToAuthstn&gt;</span>
                <span class="nt">&lt;/AuthstnRslt&gt;</span>
                <span class="c">&lt;!-- Informações sobre as ações a serem realizadas pelo POI.
                     Neste caso, as informações a serem impressas no comprovante. --&gt;</span>
                <span class="nt">&lt;Actn&gt;</span>
                    <span class="c">&lt;!-- Tipo da ação a ser realizada pelo POI.
                         PRNT = Imprimir mensagem;
                         DISP = Exibir mensagem. --&gt;</span>
                    <span class="nt">&lt;ActnTp&gt;</span>PRNT<span class="nt">&lt;/ActnTp&gt;</span>
                    <span class="c">&lt;!-- Mensagem a ser impressa no terminal. --&gt;</span>
                    <span class="nt">&lt;MsgToPres&gt;</span>
                        <span class="c">&lt;!-- A quem se destina a mensagem no contexto.
                             CRCP = CardholderReceipt;
                             MRCP = MerchantReceipt. --&gt;</span>
                        <span class="nt">&lt;MsgDstn&gt;</span>CRCP<span class="nt">&lt;/MsgDstn&gt;</span>
                        <span class="c">&lt;!-- Texto ou dados gráficos a serem impressos na tela ou em papel
                             no terminal. A mensagem será formatada conforme o campo
                             PrintLineWidth da requisição. --&gt;</span>
                        <span class="nt">&lt;MsgCntt&gt;</span>Informacoes formatadas do recibo aqui<span class="nt">&lt;/MsgCntt&gt;</span>
                    <span class="nt">&lt;/MsgToPres&gt;</span>
                <span class="nt">&lt;/Actn&gt;</span>
            <span class="nt">&lt;/TxRspn&gt;</span>
        <span class="nt">&lt;/CxlRspn&gt;</span>
    <span class="nt">&lt;/AccptrCxlRspn&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre>

<table><thead>
<tr>
<th>Campo</th>
<th>Ocorrência</th>
<th>Tipo</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>Header<code class="prettyprint">&lt;Hdr&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Cabeçalho da mensagem</td>
</tr>
<tr>
<td>MessageFunction<code class="prettyprint">&lt;MsgFctn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Identifica o tipo de processo em que a mensagem se propõe. Fixo: “CCAP” = Cancellation Response.</td>
</tr>
<tr>
<td>ProtocolVersion<code class="prettyprint">&lt;PrtcolVrsn&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Versão do protocolo utilizado na mensagem.</td>
</tr>
<tr>
<td>CreationDateTime<code class="prettyprint">&lt;CreDtTm&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Data de criação da mensagem</td>
</tr>
<tr>
<td>CancellationResponse<code class="prettyprint">&lt;CxlRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações relacionadas à resposta de cancelamento.</td>
</tr>
<tr>
<td>Environment<code class="prettyprint">&lt;Envt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Ambiente da transação.</td>
</tr>
<tr>
<td>Merchant Identification<code class="prettyprint">&lt;MrchntId&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados do estabelecimento.</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação do estabelecimento comercial no adquirente. Também conhecido internamente como “SaleAffiliationKey”.</td>
</tr>
<tr>
<td>POIId<code class="prettyprint">&lt;POIId&gt;</code></td>
<td>[0..1]</td>
<td>Container</td>
<td>Dados do ponto de interação</td>
</tr>
<tr>
<td>Identification<code class="prettyprint">&lt;Id&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Código de identificação do ponto de interação atribuído pelo estabelecimento (Campo ecoado).</td>
</tr>
<tr>
<td>Transaction<code class="prettyprint">&lt;Tx&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados da transação.</td>
</tr>
<tr>
<td>TransactionCapture<code class="prettyprint">&lt;TxCaptr&gt;</code></td>
<td>[1..1]</td>
<td>Bool</td>
<td>Indica se os dados da transação devem ser capturados <code class="prettyprint">true</code> ou não <code class="prettyprint">false</code> imediatamente.</td>
</tr>
<tr>
<td>TransactionIdentification<code class="prettyprint">&lt;TxId&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Identificação da transação atribuída pelo POI.</td>
</tr>
<tr>
<td>TransactionDateTime<code class="prettyprint">&lt;TxDtTm&gt;</code></td>
<td>[1..1]</td>
<td>DateTime</td>
<td>Data e hora local da transação definidas pelo ponto de interação.</td>
</tr>
<tr>
<td>TransactionReference<code class="prettyprint">&lt;TxRef&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Identificação da transação definida pelo ponto de interação. Este campo será ecoado pelo adquirente.</td>
</tr>
<tr>
<td>TransactionDetails<code class="prettyprint">&lt;TxDtls&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Detalhes da transação</td>
</tr>
<tr>
<td>Currency<code class="prettyprint">&lt;Ccy&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Moeda utilizada na transação em conformidade com a ISO 4217.</td>
</tr>
<tr>
<td>TotalAmount<code class="prettyprint">&lt;TtlAmt&gt;</code></td>
<td>[1..1]</td>
<td>Amount</td>
<td>Valor total da transação em centavos.</td>
</tr>
<tr>
<td>TransactionResponse<code class="prettyprint">&lt;TxRspn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de resposta da transação.</td>
</tr>
<tr>
<td>AuthorisationResult<code class="prettyprint">&lt;AuthstnRslt&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Informações sobre o resultado da autorização a ser cancelada.</td>
</tr>
<tr>
<td>ResponseToAuthorisation<code class="prettyprint">&lt;RspnToAuthstn&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Dados de resposta da autorização a ser cancelada.</td>
</tr>
<tr>
<td>Response<code class="prettyprint">&lt;Rspn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Resposta da transação. DECL: Declined; APPR: Aproved; PART: PartialApproved; TECH: TechinicalError;</td>
</tr>
<tr>
<td>ResponseReason<code class="prettyprint">&lt;RspnRsn&gt;</code></td>
<td>[0..1]</td>
<td>Text</td>
<td>Código de resposta da autorização.</td>
</tr>
<tr>
<td>CompletionRequired<code class="prettyprint">&lt;CmpltnReqrd&gt;</code></td>
<td>[0..1]</td>
<td>Bool</td>
<td>Indica se a mensagem precisa ser capturada posteriormente.</td>
</tr>
<tr>
<td>Action<code class="prettyprint">&lt;Actn&gt;</code></td>
<td>[0..*]</td>
<td>Container</td>
<td>Informações sobre as ações a serem realizadas pelo POI. Neste caso, as informações a serem impressas no comprovante.</td>
</tr>
<tr>
<td>ActionType<code class="prettyprint">&lt;ActnTp&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>Tipo da ação a ser realizada pelo POI. PRNT = Imprimir mensagem;</td>
</tr>
<tr>
<td>MessageToPresent<code class="prettyprint">&lt;MsgToPres&gt;</code></td>
<td>[1..1]</td>
<td>Container</td>
<td>Mensagem a ser impressa no terminal.</td>
</tr>
<tr>
<td>MessageDestination<code class="prettyprint">&lt;MsgDstn&gt;</code></td>
<td>[1..1]</td>
<td>CodeSet</td>
<td>A quem se destina a mensagem no contexto. Fixo: CRCP = CardholderReceipt; MRCP = MerchantReceipt.</td>
</tr>
<tr>
<td>MessageContent<code class="prettyprint">&lt;MsgCntt&gt;</code></td>
<td>[1..1]</td>
<td>Text</td>
<td>Texto ou dados gráficos a serem impressos na tela ou em papel no terminal. A mensagem será formatada conforme o campo <code class="prettyprint">PrintLineWidth</code> da requisição.</td>
</tr>
</tbody></table>
<h1 id='cdigos-de-exemplo-de-integrao'>Códigos de Exemplo de integração</h1>
<p>Os códigos de exemplo abaixo, ilustram a troca de mensagens, com requisição e resposta, para Autorização com Captura automática, Autoricação com Captura posterior, Captura, Reversão de transações e Cancelamento. Os códigos estão disponíveis no Github Stone e podem ser acessados através dos links externos abaixo.</p>

<p><a href="https://github.com/stone-pagamentos/code-sample-php">Códigos de exemplo em PHP</a></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="xml">XML Comentado</a>
                <a href="#" data-language-name="shell">cURL</a>
          </div>
      </div>
    </div>
  </body>
</html>
