
#API

## callstats.initialize()

```javascript
callStats.initialize(AppID, AppSecret, localUserID, csInitCallback, csStatsCallback, configParams);
```

- Authenticates with the callstats.io back-end to setup a trusted relationship with it.

  Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`AppID`  | Required | String | Application ID is obtained from callstats.io.
`AppSecret`  | Required | String | Application secret is obtained from callstats.io.
`localUserID`  | Required | String (256 bytes) | it is provided by the developer and MUST NOT be null or empty.
`csInitCallback`  | Optional | Callback | asynchronously reports failure or success of the protocol messages.
`csStatsCallback`  | Optional | Callback | asynchronously reports the conference statistics.
`configParams`  | Optional | JSON| it is the set of parameters to enable/disable certain features in the library.

Section on [generating userID](#generating-userid-and-conferenceid) provides more guidelines on choosing a `localUserID`.

### JSON for configParams

```javascript
var configParams = {
  disableBeforeUnloadHandler: true, // disables callstats.js's window.onbeforeunload parameter.
  applicationVersion: "app_version" // Application version specified by the developer.
};
```

It provides developers a method to enable or disable certain features or functions within the `callstats.js` library. It is a javascript object with the following OPTIONAL key-value pairs. They are:

  Keys  |  Required | Description
-----------  | -------- | ----------
`disableBeforeUnloadHandler` | No | by default the value is `false`.
`applicationVersion` | No | String of maximum length **30 characters**.

<aside class="error">
Setting `disableBeforeUnloadHandler` to `true` disengages callstats.js's `window.onbeforeunload` handler, and you will need to send the fabricTerminated event for each active PeerConnection. See more details on `fabricTerminated` <a href=/#step-5-optional-conference-events> event </a>
</aside>


## callstats.addNewFabric()
```javascript
 callStats.addNewFabric(pcObject, remoteUserID, fabricUsage, conferenceID, pcCallback);
```

- Indicates that the WebRTC application requests callstats.js to monitor the performance of the _PeerConnection_ between the two endpoints (represented by the corresponding UserIDs).

   Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`pcObject`  | Required  |  Object | _PeerConnection_ object.
`remoteUserID`  |  Required  | String (256 bytes)| It is generated by the origin server.
`fabricUsage`  |  Required  | Enum | Valid values are discussed in a later [section](#enumeration-of-fabricusage).
`conferenceID`   | Required  | String (512 bytes) | It is generated by the origin server.
`pcCallback`  | Optional  | Callback | the callback asynchronously reports failure or success for pcObject.

## callstats.reportError()

```javascript
callStats.reportError(pcObject, conferenceID, callStats.webRTCFunctions.createOffer);
```

- Notifies the callstats.io back-end about conference setup failure reason.

   Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`pcObject`  |  Required | Object | _PeerConnection_ object
`conferenceID`  |  Required | String (512 bytes)| It is generated by the origin server.
`wrtcFuncName`  |  Required | Enum | Name of the [WebRTC function](#enumeration-of-wrtcfuncnames) that failed.
`domError`  |  Optional | Object | [DOMError object](https://developer.mozilla.org/en-US/docs/Web/API/DOMError)
`localSDP`  |  Optional  |Object| Local SDP collected when errors occur.
`remoteSDP`  |  Optional  | Object | Remote SDP collected when errors occur.

<aside class="error">
<ul>

<li> pcObject MAY be set to NULL when passing in errors that occur when getUserMedia() is called.</li>
<li> localSDP MAY be set to NULL, in case you do not want SDPs to be collected. </li>
<li> remoteSDP MAY be set to NULL, in case you do not want SDPs to be collected. </li>

</ul>
</aside>

## callstats.associateMstWithUserID()
- Maps the SSRC to a userID when multiple _MediaStreamTracks_ (MSTs) are sent or received in a single _PeerConnection_.

   Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`pcObject`  | Required  | Object | _PeerConnection_ object.
`userID`  | Required  | String (256 bytes) | It is generated by the origin server.
`conferenceID`  | Required | String (512 bytes)| It is generated by the origin server.
`SSRC`  | Required | Object |Synchronization Source Identifier, as defined in [RFC3550](https://tools.ietf.org/html/rfc3550).
`usageLabel`  | Required | String (20 bytes) |it is generated by the origin server.
`associatedVideoTag`  | Optional | String | handler to the user's video tag.

<aside class="error">
<ul>

<li> SSRC is typically generated by the user-agent and MUST not be null or empty.</li>
<li> usageLabel can be set to front-camera, back-camera, screen, audio-in, mic, system-sound, enumeration-of-wrtcfuncname or anything that allows stream usage identification. </li>
<li> If you do not provide `associatedVideoTag` then callstats.js is not able to collect <b>Time-to-First-Media</b> metric</li>

</ul>
</aside>

## callstats.sendFabricEvent()
- Notifies the callstats.io back-end about user specific events (e.g., 'Hold', 'Mute', etc.) on a _PeerConnection_. It is usually generated due to local user interaction at a _PeerConnection_.

   Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`pcObject`  | Required| Object |  _PeerConnection_ object.
`fabricEvent`  | Required | Enum| with valid values discussed in a later [section](#enumeration-of-fabricevent).
`conferenceID` | Required| String (512 bytes) | It is generated by the origin server.
`eventData` | Optional| Object | event related data.

## callstats.sendUserFeedback()

- Send the feedback on conference performance indicated by the user.

   Params  |  Argument | Type | Description
-----------  | ----------- | -------- | ----------
`conferenceID`  | Required | String (512 bytes)| It is generated by the origin server.
`feedback`  | Required | Object| JSON object.
`pcCallback`  | Optional | Callback | the callback asynchronously reports failure or success of feedback submission.



### JSON for `feedback`

  Keys  |  Required | Type | Description
-----------  | -------- | -------- |----------
`userID` |  Required | String (256 bytes) | It is generated by the origin server. Discussed in a [later section](#generating-userid-and-conferenceid).
`overall` | Required | Integer (between 1-5) | Typically the scores correspond to the [mean opinion score](https://en.wikipedia.org/wiki/Mean_opinion_score), in this case this value represents the overall quality perceived by the userID.
`audio`, `video`, screen` | Optional | Integer (between 1-5) | Similar to the definition of `overall`, except these values correspond to specific types of media streams.
`comment` | Optional | String | Detailed user feedback.

