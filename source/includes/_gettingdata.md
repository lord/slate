# Reading and Writing Data

Our API uses HTTP methods and RESTful endpoints. The API authorization is using OAuth 2.0. All requests and response are in JSONs.

In this section we will provide some examples. Some will contain a pregenerated access token which we have generated by

- registering an application to generate a client,
* performing an activation flow for the "klaus" test-user in the sandbox.


## API Endpoints

This is an overview of the available endpoints to get data. Please also check out [our swagger-based API reference for all GET calls](https://api.itembase.com/api/docs/#!). The POST /snippet functionality will be explained below.

| Entity | Supported Methods | URL | Notes |
|--------|--------|--------|-------|
| Transactions | GET | https://sandbox.api.itembase.io/v1/users/$user_id/transactions  |   |
| Products | GET | https://sandbox.api.itembase.io/v1/users/$user_id/products  |  |
| Buyers | GET | https://sandbox.api.itembase.io/v1/users/$user_id/buyers  |  |
| Profiles | GET | https://sandbox.api.itembase.io/v1/users/$user_id/profiles  |  |
| Snippets | GET, POST, PUT | https://sandbox.api.itembase.io/v2/users/$user_id/connections/$connection_id/snippets | Be aware that the base path is */v2*. To POST a snippet, you need to specify a single connection. |

Where```user_id``` is the uuid of the user that has granted you access, and ```connection_id``` the specific connection id that points to the user's shop connection. In the examples for our sandbox, we have already set up a connection for you.

## Getting All New and Updated Products

Assuming that you already obtained a valid access token and activated your solution for a user:

* ```access_token```: your OAuth2 client can get this using its client_id and refresh token
* ```user_id```: the uuid of the user that has granted you access
* ```base_url```: http://sandbox.api.itembase.io/v1/users
* ```resource```: the resource you want to access, like "products"

All resources expose inserted_at_from/-to, created_at_from/-to and updated_at_from/to query parameter that can easily be used to get all new and updated entities. Just make sure to set a "to" parameter so that you can reuse it in your next scheduled GET call. See our api reference (above) for more details.
<aside class="notice">Inserted_at refers to our server time, created_at and updated_at to the connected remote platform's time.</aside>

```shell
#!/bin/bash

access_token = < generate this using your oauth2.0 clients refresh token for the given user >
current_datetime = < generate the current datetime in ISO 8601 format >
last_check_datetime = < this is the last time the script was run, as date time in ISO 8601 format >
user_id = < the id of the user that has granted you access >
resource = < the name of the resource you want to get >

auth_header="Authorization: Bearer $access_token"
url="<base_url>/<user_id>/$resource?inserted_at_from=$last_check_datetime&inserted_at_to=$current_datetime"

curl --compressed --verbose -X GET --header "Accept: application/json" --header $auth_header $url | jq .
```

Alternatively, you can try out the request below with a pregenerated access token for the test user.

<iframe src="http://api.apiembed.com/?source=http://sandbox.static.dataconnect.io/files/get_products.har&targets=shell:curl,node:unirest,java:unirest,python:requests,php:curl,ruby:native,go:native,java:okhttp" frameborder="0" scrolling="no" width="100%" height="300px" seamless></iframe>

## Posting a Snippet to a Shop Frontend
As a first public feature for version 2 of our API, you can add a snippet entity as a Json with CSS or Javascript content using our connectors. This happens asynchronously, so a flow could look like this:

1. Follow the activation flow described in the "getting access"-section to activate your solution for a user's shop connection. If you are on sandbox, we have set up a magento shop for our test user and provide the details below.
2. GET the user's profile and remember the shop's url.
3. POST your snippet to the shop using the userid, connectionid and the _snippets_ endpoint.
<iframe src="http://api.apiembed.com/?source=http://sandbox.static.dataconnect.io/files/post_snippet.har&targets=shell:curl,node:unirest,java:unirest,python:requests,php:curl,ruby:native,go:native,java:okhttp" frameborder="0" scrolling="no" width="100%" height="300px" seamless></iframe>
4. The response will be a _job_ entitiy. This contains a link you can check to see if the snippets has been deployed to the remote shop. This should happen in a few seconds.
5. GET the _job_ using the ID or a list cal and check the job status. Is it done? Then proceed.
<iframe src="http://api.apiembed.com/?source=http://sandbox.static.dataconnect.io/files/get_jobs.har&targets=shell:curl,node:unirest,java:unirest,python:requests,php:curl,ruby:native,go:native,java:okhttp" frameborder="0" scrolling="no" width="100%" height="300px" seamless></iframe>
6. Visit the shop's url and **enjoy the result**.
7. If you want to change your snippet, please use PUT to overwrite your posted snippet.