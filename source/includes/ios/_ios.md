# iOS SDK

## Introduction

### SDK Module Command Protocol

Every Sensum SDK module conforms to the module command protocol.
At present these can be switched on and off independently. Every SDK managed object has three states that can be toggled independently:

* Updating: You will get live data updates from the respective managed object. If you have defined a listener for that object it’s update methods will be called by the SDK and you can reflect these and carry out actions in your app.
* Recording: Data updates will be stored only. If you do not turn on updates no data can be recorded as updates will not be read.
* Sending To API: Data updates will be recorded and sent to the Emotion AI service.

> Protocol Code - SDK written in Swift 3

```swift
import foundation

public protocol SDKModuleCommandProtocol {
    func startUpdating()
    func stopUpdating()
    func startRecording()
    func stopRecording()
    func startSendingToAPI()
    func stopSendingToAPI()
    func isUpdating() -> Bool
    func isRecording() -> Bool
    func isSendingToAPI() -> Bool
}
```

## Starting the SDK

To start the SDK you will need:

 * An API Key,
 * A host URL,
 * A stage URL.
We will provide you with the API Key as a string, all you have to do is pass this string into the SensumSDKManager .

By default, the host URL and stage URL should be api.sensum.co and v0 respectively, unless we have instructed you otherwise.

In order to create a single instance of the SensumSDKManager, follow the example within the code snippet opposite (the example makes use of a ViewController to do this, but this could be achieved within any file)

> Code Snippet

```swift
import UIKit
import SensumKit

class TabBarController: UITabBarController {
	var sensumSDK : SensumSDKManager?
	
	override func viewDidLoad() {
           super.viewDidLoad()
           // Do any additional setup after loading the view, typically from a nib.
           sensumSDK = SensumSDKManager(
               requestEngineInternalInSeconds: 30,
               apiKey: "PublicDemoKeyForDocumentation",
               host: "api.sensum.co",
               stage: "v0")
	    startEverythingUpdating()
       }
	
	func startEverythingUpdating() {
		sensumSDK?.accelerometer.startUpdating()
		sensumSDK?.location.startUpdating()
		sensumSDK?.bluetooth.startUpdating()
		sensumSDK?.tag.startUpdating()
	}	
}
```

This single instance of the SensumSDKManager can then be referenced from elsewhere within your application.

## Authentication

To get started working with the Sensum SDK manager you’re going to need a valid Authentication session. Create an instance of this object and give it valid sign in details. When using third-party login providers you must provide us with an Audience ID. In the case of Google Sign-In, you must provide use with the Google Applications Client ID. You can find this id contained inside the plist configuration file generated when you set up the login application. For more details please read Google's documentation <a href="https://developers.google.com/identity/sign-in/ios/start-integrating"> here</a>.

### Initialisation

`var authenticationObj = Authentication(apiKey, host, stage)`

Create an instance of the Authentication object, specifying the Cognito Identity Pool Id, the host URL, stage and your API key.
These should all have been provided to you by Sensum when you requested API access.

### Parameters

|Name|Description|
|----|-----------|
|identityPoolId|This is the Cognito identity pool ID we have given you to use|
|host|This is the base URL of the API, this may change over time hence we allow you to configure this from your app|
|stage|This is typically the version of the API you want to use. Defaults is 'v0'.
|apiKey|This is your unique developer's API access key, contact Sensum to get one if we haven't given you one already|


## Authentication Command 

`var authenticationCommandObj = AuthenticationCommand(authenticationObj)`

### Federated sign in 

In order to authenticate you must sign in using Google Sign-in. Once this has been implemented, use this function to sign in to access the Emotion AI service.

`authenticationCommandObj.federatedSignIn()`  

### Parameters

|Name|Description|
|----|-----------|
|provider| The URL of the identity provider that you are using this will be 'accounts.google.com' in the case of Google Sign-In|
|authenticationToken|This is the authentication token generated by successful login with the identity provider| 


## API Command

All available commands for configuring and enabling API communication 

### Initialisation 

`var apiCommand = APICommand()`

### Set Server Request Rate

`apiCommand.setServerRequestRate(requestRateInSeconds)`

Set how frequently data is uploaded to the server.

### Parameters

|Name|Description|
|----|-----------|
|requestRateInSeconds|Frequency of server updates in seconds|

### Get Server Request Rate

`apiCommand.getServerRequestRate()`

 Returns how often requests are sent to the API

### Assign Listener

`apiCommand.assignListener(listener)`

Assign a listener to listen for API events

### Parameters

|Name|Type|Description|
|----|-----------|----|
|listener|APIResponseListener|An instance of a class that conforms to the APIResponseListener extension|

## Accelerometer Command

All available commands for the Sensum accelerometer SDK


### Start Updating

`sdkManager?.accelerometer.startUpdating()`

Start the updates from CoreMotion

### Stop Updating

`sdkManager?accelerometer.stopUpdating()`

Stop the updates from CoreMotion

### Start Recording

`sdkManager?accelerometer.startRecording()`

Start recording the updates from CoreMotion

### Stop Recording

`sdkManager?accelerometer.stopRecording()`

Stop recording the updates from CoreMotion

### Start Sending to API

`sdkManager?accelerometer.startSendingToAPI()`

Start sending the updates of CoreMotion to the Emotion AI service

### Stop Sending to API

`sdkManager?accelerometer.stopSendingToAPI()`

Stop sending the updates of CoreMotion to the Emotion AI service


### Check Module Update Status

`sdkManager?accelerometer.isUpdating()`

Check if module is updating. Returns a boolean value.

### Check Module Recording Status

`sdkManager?accelerometer.isRecording()`

Check if module is recording. Returns a boolean value.

### Check Emotion AI Update Status

`sdkManager?accelerometer.isSendingToAPI()`

Check if module is sending to the Emotion AI Service

### Assign Listener
 
`sdkManager?accelerometer.assignListener(listener)`

Assign a listener to the accelerometer module to receive accelerometer event updates.


### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|listener|AccelerometerListener|An instance of a class that conforms to the AccelerometerListener extension|

### Set Read Frequency

`sdkManager?accelerometer.setReadFrequency(newIntervalInSeconds)`

Set the frequency of the updates from the accelerometer.

### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|newIntervalInSeconds|Double|Set the interval time in seconds, (minimum interval is 0.01s)|



## Bluetooth Command

Below are all available commands relating to Bluetooth in the iOS SDK.


### Start Updating

`sdkManager?bluetooth.startUpdating()`

Start the updates of any connected heart rate peripheral 

### Stop Updating

 `sdkManager?bluetooth.stopUpdating()`

Stop the updates of any connected heart rate peripheral

### Start Recording

 `sdkManager?bluetooth.startRecording()`

Start recording the updates of any connected heart rate peripheral 

### Stop Recording

`sdkManager?bluetooth.stopRecording()`

Stop recording the updates of any connected heart rate peripheral

### Start Sending to Emotion AI Service

`sdkManager?bluetooth.startSendingToAPI()`

Start sending the updates of any connected heart rate peripheral to the Emotion AI service

### Stop Sending to Emotion AI Service

`sdkManager?bluetooth.stopSendingToAPI()`

Stop sending the updates of any connected heart rate peripheral to the Emotion AI service

### Check Module Update Status

`sdkManager?bluetooth.isUpdating()`

Check if module is updating. Returns a boolean value.

### Check Module Recording Status

`sdkManager?bluetooth.isRecording()`

Check if module is recording. Returns a boolean value.

### Check Emotion AI Update Status

`sdkManager?bluetooth.isSendingToAPI()`

Check if module is sending to the Emotion AI Service

### Assign Listener
 
`sdkManager?bluetooth.assignListener(listener)`

Assign a listener to the bluetooth module to receive bluetooth event updates.


### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|listener|BluetoothListener|An instance of a class that conforms to the BluetoothListener extension|

### Start Scan for Devices

`sdkManager?bluetooth.startScanForDevices()`

Start scanning for discoverable peripheral devices

### Connect to peripheral device

`sdkManager?bluetooth.connectTo(peripheralDevice)`

Connect to a discovered peripheral device. Discovered devices can be acquired from the listOfDevices returned by the getDeviceList() function.

### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|peripheralDevice|CBPeripheral|The bluetooth peripheral device you want to connect to|

### Clear List of Discovered Devices

`sdkManager?bluetooth.clearDeviceList()`

Clear the list of devices discovered (equivalent to a refresh)


### Disconnect from Device

`sdkManager?bluetooth.disconnect()`

Disconnect from the currently connected peripheral device

### Get Device List

`sdkManager?bluetooth.getDeviceList()`

Return a list of all discovered peripherals. This list is populated when startScanForDevices() is called.

Returns a list of dictionaries containing bluetooth peripheral information with three fields:

|Field Name|Type|Description|
|----------|----|-----------|
|deviceName|String|returns a String of the device name|
|peripheral|CoreBluetooth CBPeripheral| returns the CoreBluetooth CBPeripheral object (import CoreBluetooth to use this)|
|type|String|For now all peripherals are of type BLE|

> Example Usage

````swift
     if let peripheralDictionary = sdkManager?.bluetooth.getDeviceList()[index]?["peripheral"] {
        let peripheralToAdd = peripheralDictionary as! CBPeripheral
     }
````
## Location Command

All available commands for the Sensum location SDK


### Start Updating

`sdkManager?location.startUpdating()`

Start the updates from CoreLocation

### Stop Updating

`sdkManager?location.stopUpdating()`

Stop the updates from CoreLocation

### Start Recording

`sdkManager?location.startRecording()`

Start recording the updates from CoreLocation

### Stop Recording

`sdkManager?location.stopRecording()`

Stop recording the updates from CoreLocation

### Start Sending to API

`sdkManager?location.startSendingToAPI()`

Start sending the updates of CoreLocation to the Emotion AI service

### Stop Sending to API

`sdkManager?location.stopSendingToAPI()`

Stop sending the updates of CoreLocation to the Emotion AI service


### Check Module Update Status

`sdkManager?location.isUpdating()`

Check if module is updating. Returns a boolean value.

### Check Module Recording Status

`sdkManager?location.isRecording()`

Check if module is recording. Returns a boolean value.

### Check Emotion AI Update Status

`sdkManager?location.isSendingToAPI()`

Check if module is sending to the Emotion AI Service

### Assign Listener
 
`sdkManager?location.assignListener()`

Assign a listener to the location module to receive location event updates.


### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|listener|LocationListener|An instance of a class that conforms to the LocationListener extension|

## Tag Command

All available commands for our tagging module. This is useful for noting events that occur in data. e.g. "Started workout set", "Jumped out of a plane", "Finished jogging".
These events are automatically timestamped.


### Start Updating

`sdkManager?tag.startUpdating()`

Start the updates from CoreMotion

### Stop Updating

`sdkManager?tag.stopUpdating()`

Stop the updates from CoreMotion

### Start Recording

`sdkManager?tag.startRecording()`

Start recording the updates from CoreMotion

### Stop Recording

`sdkManager?tag.stopRecording()`

Stop recording the updates from CoreMotion

### Start Sending to API

`sdkManager?tag.startSendingToAPI()`

Start sending the updates of CoreMotion to the Emotion AI service

### Stop Sending to API

`sdkManager?tag.stopSendingToAPI()`

Stop sending the updates of CoreMotion to the Emotion AI service


### Check Module Update Status

`sdkManager?tag.isUpdating()`

Check if module is updating. Returns a boolean value.

### Check Module Recording Status

`sdkManager?tag.isRecording()`

Check if module is recording. Returns a boolean value.

### Check Emotion AI Update Status

`sdkManager?tag.isSendingToAPI()`

Check if module is sending to the Emotion AI Service

### Assign Listener
 
`sdkManager?tag.assignListener(listener)`

Assign a listener to the tag module to receive tag event updates.


### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|listener|TagListener|An instance of a class that conforms to the TagListener extension|

### Create Tag

`sdkManager?tag.createTag(tag)`

Creates a tag object composed of a string and timestamp pair

### Parameters
|Parameter|Type|Description|
|---------|----|-----------|
|tag|String|A string object of a message or emoticon|



