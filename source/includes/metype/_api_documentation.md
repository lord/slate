# API Documentation

## Accounts

### Create an account under an organization

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/<organization_id>/accounts \
  -H 'Content-Type: application/json' \
  -d '{
	"authentication_token": <authentication_token>,
	"account_name": <account_name>,
	"account_email": <account_email>,
	"website_url": <website_url>
}'
```

```shell--response

{
  "id": 10,
  "config": null,
  "itsman_url": null,
  "name": "foo_1",
  "domains": [
      "http://localhost:3000"
  ],
  "profane_words": [],
  "profanity_configuration": {},
  "comments_limit": 4,
  "logo": null,
  "configurations": [
      {
          "id": 3,
          "name": "enable_image_uploads",
          "display_name": "Images/GIFs in comments"
      }
  ],
  "comment_reaction_sets": [],
  "page_reaction_sets": {
      "id": 10,
      "account_id": 10,
      "reaction_set": [
          {
              "id": 23,
              "account_id": 10,
              "reaction_id": 3,
              "shortcode": ":smiley:",
              "label": "Happy"
          },
          {
              "id": 24,
              "account_id": 10,
              "reaction_id": 4,
              "shortcode": ":cry:",
              "label": "Sad"
          },
          {
              "id": 25,
              "account_id": 10,
              "reaction_id": 5,
              "shortcode": ":sunglasses:",
              "label": "Cool"
          }
      ],
      "created_at": "2018-09-04T06:51:08.812Z",
      "updated_at": "2018-09-04T06:51:08.812Z"
  },
  "total_comments_count": 0,
  "is_paid_account": false
}
```
This endpoint creates an account under an organization


<aside class="notice">
Reach out to metype team to get organization id and authentication token.
</aside>

### HTTP Request

`POST https://www.metype.com/api/v1/organizations/:organization_id/accounts`

### Body Parameters
| Parameter | Required | Description |
|-----------|----------|-------------|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs |
|account_name| Yes | Name of the account |
|account_email| Yes | Email related to the account |
|website_url| Yes | URL of the website where metype will be used |

### Response codes
| Response code | Description |
|---------------|-------------|
|201|Account is created|
|400|When required paramaters are not sent with API|
|401|When you pass wrong organization credentials i.e., organization_id or authentication_token|
|404|When organization_id is not passed or invalid organization_id is not passed|
|422|When an invalid website_url is sent as a parameter|

## Users

### Create a user under an organization

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/<organization_id>/users \
  -d '{
	"authentication_token" : <authentication_toke>,
	"user":{
		"name":<name>,
		"email":<email>
	}
}'
```

```shell--response
{
    "id": 11,
    "name": "name",
    "avatar": null,
    "guest": false,
    "bio": "",
    "slug": "name-3",
    "accounts": []
}
```

This endpoint creates a user under an organization
<aside class="notice">
Reach out to metype team to get organization id and authentication token.
</aside>

### HTTP Request

`POST https://www.metype.com/api/v1/organizations/:organization_id/users`

### Body Parameters
| Parameter | Required | Description |
|-----------|----------|-------------|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs |
|name| Yes | Name of the user |
|email| Yes | Email of the user |

### Response codes
| Response code | Description |
|---------------|-------------|
|201|User is created|
|400|When required paramaters are not sent with API|
|401|When you pass wrong organization credentials i.e., organization_id or authentication_token|
|404|When organization_id is not passed or invalid path|
|422|When user paramater or name is empty|

## Comments Creation

### Create a comment under an organization using account and user

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/<organization_id>/accounts/<account_id>/comments \
  -H 'Content-Type: application/json' \
  -d '{
	"authentication_token" : <authentication_toke>,
	"page_id": <page_id>,
  "comment": {
    "comment": "text"
  },
    "user_id": <user_id>
  }'
```

```shell--response
{
    "comment": {
        "id": 207,
        "comment_realm_id": 3,
        "page_id": 2,
        "body": {
            "comment": "text"
        },
        "created_at": "2018-09-06T12:24:07.005Z",
        "parent_comment_id": null,
        "author_id": 19,
        "hidden_by_id": null,
        "hidden_at": null,
        "deleted_by_id": null,
        "deleted_at": null,
        "reactions": {},
        "edited_at": null,
        "is_spam": false,
        "is_published": true,
        "page_url": "https://foobar.com/stairway-way-to-heaven",
        "hero_image_url": null,
        "headline": null,
        "hidden": false,
        "deleted": false,
        "realm_comment_count": 1,
        "author": {
            "id": 19,
            "name": "name",
            "avatar": null,
            "guest": false,
            "bio": "",
            "slug": "name-4"
        }
    }
}

```

This endpoint creates a comment under an organization and account
<aside class="notice">
Reach out to metype team to get organization id and authentication token.
</aside>

### HTTP Request

`POST https://www.metype.com/api/v1/organizations/:organization_id/accounts/:account_id/comments`

### Body Parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs |
|page_id| Yes | Url of page which owns the comment |Base64 encoded|
|comment| Yes | JSON structure to store comment |
|user_id|| Yes | The author id of the comment |
|parent_comment_id| No | If the comment is reply. Give parent comment id. |

### Response codes
| Response code | Description |
|---------------|-------------|
|201|Comment is created.|
|400|When required paramaters are not sent with API or invalid parameters are sent with API.|
|401|When you pass wrong organization credentials i.e., organization_id or authentication_token|
|404|When organization_id or account_id is not passed or invalid path.|
|422|When invalid page_id or user_id or parent_comment_id is passed.|


## Admin

### List all account comments for an account

```shell--request
curl -X GET \
  'https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments?authentication_token=SDtWvarjZwxyQd3JzMQQ&user_id=52'
```

```shell--response
list comment response:

{
    "comments": [
        {
            "id": 44,
            "comment_realm_id": 11,
            "page_id": 1,
            "body": {
                "ops": [
                    {
                        "insert": "foobar"
                    }
                ]
            },
            "created_at": "2018-09-12T06:40:35.189Z",
            "parent_comment_id": null,
            "author_id": 52,
            "hidden_by_id": null,
            "hidden_at": null,
            "deleted_by_id": null,
            "deleted_at": null,
            "reactions": {},
            "edited_at": null,
            "is_spam": false,
            "is_published": true,
            "page_url": "https://example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": false,
            "realm_comment_count": 1,
            "author": {
                "id": 52,
                "name": "Foobar",
                "avatar": "https://www.example.com/avatar.jpg",
                "guest": false,
                "bio": "",
                "slug": "foobar"
            }
        }
    ],
    "total_entries": 1,
    "total_pages": 1
}
```

`GET https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments`

<aside class="notice">
Reach out to metype team to get organization id and authentication token.
</aside>


### Query parameters

| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|page| No | Page number. Default: 1 | Integer
|per_page| No | Number of comments to load per page. Default: 10 | Integer
|status| No | Get comments based on status. Accepted values: "approved", "hidden_or_deleted", "pending" | String
|spam| No | Get only spam comments | Boolean
|sort_order| No | sort comments response by ascending or descending order. Accepted values: "asc", "desc". Default: "desc" | String


### Search Comments

```shell--request
	curl -X GET \
  'https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments?authentication_token=SDtWvarjZwxyQd3JzMQQ&user_id=52&mquery=foobar'
```

```shell--response
search comment response:

	{
    "comments": [
        {
            "id": 44,
            "comment_realm_id": 11,
            "page_id": 1,
            "body": {
                "ops": [
                    {
                        "insert": "foobar"
                    }
                ]
            },
            "created_at": "2018-09-12T06:40:35.189Z",
            "parent_comment_id": null,
            "author_id": 52,
            "hidden_by_id": null,
            "hidden_at": null,
            "deleted_by_id": null,
            "deleted_at": null,
            "reactions": {},
            "edited_at": null,
            "is_spam": false,
            "is_published": true,
            "page_url": "https://www.example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": false,
            "realm_comment_count": 1,
            "author": {
                "id": 123,
                "name": "fooauthor",
                "avatar": "https://www.example.com/photo.jpg",
                "guest": false,
                "bio": "",
                "slug": "fooauthor"
            }
        }
    ],
    "total_entries": 3,
    "total_pages": 1
}
```

`GET https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments`

### Query parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|mquery| Yes | search term to get matching comments | String

### View Comment Detail

```shell--request
	curl -X GET \
	'http://localhost:3000/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments/44?authentication_token=SDtWvarjZwxyQd3JzMQQ&user_id=52'
```

```shell--response
comment-detail response:
	{
    "comment": {
        "id": 44,
        "comment_realm_id": 11,
        "page_id": 1,
        "body": {
            "ops": [
                {
                    "insert": "foobar"
                }
            ]
        },
        "created_at": "2018-09-12T06:40:35.189Z",
        "parent_comment_id": null,
        "author_id": 123,
        "hidden_by_id": null,
        "hidden_at": null,
        "deleted_by_id": null,
        "deleted_at": null,
        "reactions": {},
        "edited_at": null,
        "is_spam": false,
        "is_published": true,
        "page_url": "http://example.com/page_url",
        "hero_image_url": null,
        "headline": null,
        "hidden": false,
        "deleted": false,
        "realm_comment_count": 1,
        "author": {
            "id": 123,
            "name": "FooAuthor",
            "avatar": "https://www.example.com/photo.jpg",
            "guest": false,
            "bio": "",
            "slug": "fooAuthor"
        }
    },
    "timeline": [
        {
            "event": "submitted_at",
            "event_time": "2018-09-12T06:40:35.193Z",
            "event_by": "FooAuthor"
        }
    ]
}

```

GET `https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments/<comment_id>`

### Query parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer


### Approve Comment(s)

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments/approve \
  -H 'Content-Type: application/json' \
  -d '{
    "authentication_token" : "SDtWvarjZwxyQd3JzMQQ",
    "user_id": 52,
    "comment_ids": [44]
  }
'
```

```shell--response

Approve comment response:

	{
    "comment": [
        {
            "is_spam": false,
            "is_published": true,
            "body": {
                "ops": [
                    {
                        "insert": "foobar"
                    }
                ]
            },
            "parent_comment_id": null,
            "id": 44,
            "comment_realm_id": 11,
            "page_id": 1,
            "created_at": "2018-09-12T06:40:35.189Z",
            "author_id": 123,
            "hidden_by_id": null,
            "hidden_at": null,
            "deleted_by_id": null,
            "deleted_at": null,
            "reactions": {},
            "edited_at": null,
            "page_url": "http://www.example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": false,
            "realm_comment_count": 1,
            "author": {
                "id": 123,
                "name": "fooAuthor",
                "avatar": "http://www.example.com/photo.jpg",
                "guest": false,
                "bio": "",
                "slug": "fooAuthor"
            }
        }
    ]
}
```

`POST https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments/approve`

### Body parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|comment_ids| Yes | Comment id(s) whose state needs to be changed from pending to published | Array



### Restore Comment(s)

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments/restore \
  -H 'Content-Type: application/json' \
  -d '{
    "authentication_token" : "SDtWvarjZwxyQd3JzMQQ",
    "user_id": 52,
    "comment_ids": [37]
  }
'
```

```shell--response
Restore comment response:
	{
    "comment": [
        {
            "author_id": 123,
            "hidden_at": null,
            "deleted_at": null,
            "deleted_by_id": null,
            "is_published": true,
            "id": 37,
            "body": {
                "comment": "testing"
            },
            "comment_realm_id": 1,
            "page_id": 1,
            "created_at": "2018-09-11T10:36:34.757Z",
            "parent_comment_id": null,
            "hidden_by_id": null,
            "reactions": {},
            "edited_at": null,
            "is_spam": false,
            "page_url": "http://www.example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": false,
            "realm_comment_count": 10,
            "author": {
                "id": 123,
                "name": "FooAuthor",
                "avatar": "http://www.example.com/photo.jpg",
                "guest": false,
                "bio": "",
                "slug": "fooAuthor"
            }
        }
    ]
}
```

`POST https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments/restore`

### Body parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|comment_ids| Yes | Comment id(s) whose state needs to be changed from deleted to published | Array


### Delete Comment(s)

```shell--request
curl -X DELETE \
  https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments \
  -H 'Content-Type: application/json' \
  -d '{
    "authentication_token" : "SDtWvarjZwxyQd3JzMQQ",
    "user_id": 52,
    "comment_ids": [44]
  }
'
```

```shell--response

delete comment response:

	{
    "comment": [
        {
            "deleted_at": "2018-09-12T07:22:53.810Z",
            "id": 44,
            "comment_realm_id": 11,
            "page_id": 1,
            "created_at": "2018-09-12T06:40:35.189Z",
            "parent_comment_id": null,
            "hidden_by_id": null,
            "hidden_at": null,
            "reactions": {},
            "is_spam": false,
            "is_published": true,
            "page_url": "https://example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": true,
            "realm_comment_count": 1
        }
    ]
}
```

`DELETE https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id/comments`


### Body parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|comment_ids| Yes | Comment id(s) whose state needs to be changed from pending/approved to deleted | Array


### Spam Comments(s)

```shell--request
curl -X POST \
  https://www.metype.com/api/v1/organizations/724ef842-799d-4acc-9dd6-ce038f13eb4b/admin/accounts/2/comments/spam \
  -H 'Content-Type: application/json' \
  -d '{
    "authentication_token" : "SDtWvarjZwxyQd3JzMQQ",
    "user_id": 52,
    "comment_ids": [44]
  }
'
```

```shell--response

spam response:

{
    "comment": [
        {
            "id": 44,
            "is_spam": true,
            "comment_realm_id": 11,
            "page_id": 1,
            "created_at": "2018-09-12T06:40:35.189Z",
            "parent_comment_id": null,
            "hidden_by_id": null,
            "hidden_at": null,
            "deleted_at": "2018-09-12T07:22:53.810Z",
            "reactions": {},
            "is_published": true,
            "page_url": "http://example.com/page_url",
            "hero_image_url": null,
            "headline": null,
            "hidden": false,
            "deleted": true,
            "realm_comment_count": 1
        }
    ]
}
```

`POST https://www.metype.com/api/v1/organizations/<organization_id>/admin/accounts/<account_id>/comments/spam`

### Body parameters
| Parameter | Required | Description |Type|
|-----------|----------|-------------|----|
|authentication_token| Yes | Authentication token generated by the metype team to access APIs | String
|user_id| Yes | Account Owner user_id | Integer
|comment_ids| Yes | Comment id(s) whose state needs to be changed from pending/approved/trash to spam | Array
